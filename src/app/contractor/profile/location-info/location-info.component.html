<ion-grid>
  <ion-row>
    <ion-col size="12">
      <ion-card class="form-card">
        <ion-card-header class="card-header">
          <h2>Location & Professional Info</h2>
          <p>Tell us about your position and skills</p>
        </ion-card-header>
        <ion-card-content [formGroup]="form" class="form-section">
          <div class="form-group">
            <label class="form-label">Position*</label>
            <ion-select size="" formControlName="position" interface="popover" fill="outline" 
              placeholder="Select Position">
              <ion-select-option *ngFor="let item of allPositions"
                [value]="item._id">{{item.positionName}}</ion-select-option>
            </ion-select>
            <div class="error-message" *ngIf="form.get('position')?.touched && form.get('position')?.hasError('required')">
              Position is required
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Top 3 Technologies*</label>
            <ion-searchbar #technologySearchbar class="search-bar" type="text" debounce="100"
              placeholder="Search and select technologies" (ionInput)="getTechnologies($event)"></ion-searchbar>
            <ion-list *ngIf="isTechnologyAvailable" class="suggestion-list">
              <ion-item class="suggestion-item" *ngFor="let item of filteredTechnologies"
                (click)="onTechnologySelected(item)">
                {{item?.technologyName}}
              </ion-item>
            </ion-list>
            <div class="selected-items-section" *ngIf="selectedTechnologies.length > 0">
              <ion-chip *ngFor="let item of selectedTechnologies" class="tech-chip">
                <ion-label>{{item.technologyName}}</ion-label>
                <ion-icon name="close-circle" (click)="onTechnologySelectedRemoved(item)"></ion-icon>
              </ion-chip>
            </div>
            <div class="warning-message" *ngIf="selectedTechnologies.length > 0 && selectedTechnologies.length < 3">
              <ion-icon name="alert-circle-outline"></ion-icon>
              Please select {{3 - selectedTechnologies.length}} more technologies
            </div>
            <div class="error-message" *ngIf="selectedTechnologies.length === 0 && form.get('technologies')?.touched">
              Please select 3 technologies
            </div>
            <div class="success-message" *ngIf="selectedTechnologies.length === 3">
              <ion-icon name="checkmark-circle-outline"></ion-icon>
              All technologies selected
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Top 3 Certifications*</label>
            <ion-searchbar #certificationSearchbar class="search-bar" type="text" debounce="100"
              placeholder="Search and select certifications" (ionInput)="getCertifications($event)"></ion-searchbar>
            <ion-list *ngIf="isCertificationAvailable && filteredCertifications.length > 0" class="suggestion-list">
              <ion-item class="suggestion-item" *ngFor="let item of filteredCertifications"
                (click)="onCertificationSelected(item)">
                {{item?.certificationName}}
              </ion-item>
            </ion-list>
            <div class="no-results" *ngIf="isCertificationAvailable && filteredCertifications.length === 0">
              <p>No certifications found</p>
            </div>
            <div class="selected-items-section" *ngIf="selectedCertifications.length > 0">
              <ion-chip *ngFor="let item of selectedCertifications" class="cert-chip">
                <ion-label>{{item.certificationName}}</ion-label>
                <ion-icon name="close-circle" (click)="onCertificationSelectedRemoved(item)"></ion-icon>
              </ion-chip>
            </div>
            <div *ngIf="certificationSelectionErrorMessage" class="error-message mt-2">
              {{certificationSelectionErrorMessage}}
            </div>
            <div class="warning-message" *ngIf="selectedCertifications.length > 0 && selectedCertifications.length < 3">
              <ion-icon name="alert-circle-outline"></ion-icon>
              Please select {{3 - selectedCertifications.length}} more certifications
            </div>
            <div class="error-message" *ngIf="selectedCertifications.length === 0 && form.get('certifications')?.touched">
              Please select 3 certifications
            </div>
            <div class="success-message" *ngIf="selectedCertifications.length === 3">
              <ion-icon name="checkmark-circle-outline"></ion-icon>
              All certifications selected
            </div>
          </div>
        </ion-card-content>
        <div class="button-section">
          <ion-button fill="outline" (click)="previous()" [disabled]="isLoading">
            <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
            Previous
          </ion-button>
          <ion-button (click)="next()" [disabled]="isLoading">
            <span *ngIf="!isLoading">Save & Next</span>
            <span *ngIf="isLoading">
              <ion-spinner name="crescent"></ion-spinner>
              Saving...
            </span>
            <ion-icon slot="end" name="arrow-forward-outline" *ngIf="!isLoading"></ion-icon>
          </ion-button>
        </div>
      </ion-card>
    </ion-col>
  </ion-row>
</ion-grid>